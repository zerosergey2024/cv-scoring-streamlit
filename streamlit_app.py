import streamlit as st
import openai

st.title('CV Scoring App')

# üîê –ë–µ—Ä—ë–º –∫–ª—é—á –∏–∑ Streamlit secrets
client = openai.OpenAI(api_key=st.secrets["OPENAI_API_KEY"]) 

# üß† –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
SYSTEM_PROMPT = """
–ü—Ä–æ—Å–∫–æ—Ä—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –ø–æ —Å—Ç–µ–ø–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏.
–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ä–µ–∫—Ä—É—Ç–µ—Ä. 
–í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –æ—Ü–µ–Ω–∏—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é –≤–∞–∫–∞–Ω—Å–∏–∏. –ü—Ä–∞–≤–∏–ª–∞: 
- –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π—Ç–µ —Ñ–∞–∫—Ç—ã –æ –∫–∞–Ω–¥–∏–¥–∞—Ç–µ.:
–ó–∞–¥–∞—á–∞:
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª. 
–í—ã—è–≤–∏—Ç—å, —Å–ø–æ—Å–æ–±–µ–Ω –ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —É—á–∏—Ç—ã–≤–∞—è —Å–æ—Ñ—Ç-—Å–∫–∏–ª–ª—ã –∏ –ª–∏—á–Ω–æ—Å—Ç–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞. 
- –û—Ü–µ–Ω–∏–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —É–∫–∞–∑–∞–Ω–æ –≤ —Ä–µ–∑—é–º–µ. 
- –ë—É–¥—å—Ç–µ –∫—Ä–∞—Ç–∫–∏–º–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏. –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞: 
1) –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (–æ—Ç 1 –¥–æ 10) 
2) –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–≤ –≤–∏–¥–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞) 
3) –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –∏–ª–∏ —Ä–∏—Å–∫–∏ (–ø—É–Ω–∫—Ç—ã) 
4) –ö—Ä–∞—Ç–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
"""

def request_gpt(system_prompt, user_prompt):
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},  
            {"role": "user", "content": user_prompt},     
        ],
        max_tokens=1000,
        temperature=0,
    )
    return response.choices[0].message.content

#–°–æ–∑–¥–∞—ë–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –¥–ª—è CV –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
job_description = st.text_area('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏')
cv = st.text_area('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ')

#–°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤—ã–≤–æ–¥ —Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ.
if st.button('Score CV'):
    with st.spinner('Scoring CV...'):
        response = request_gpt('Score the CV based on the job description', f'Job description: {job_description}\nCV: {cv}')
    st.write(response)

